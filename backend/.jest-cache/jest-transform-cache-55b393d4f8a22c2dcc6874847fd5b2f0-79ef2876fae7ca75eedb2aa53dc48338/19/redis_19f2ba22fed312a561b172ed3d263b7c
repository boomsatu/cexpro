aff6d3e7d18ede605f346bbc00c994fd
const redis = require('redis');

// Redis configuration
const redisConfig = {
  host: process.env.REDIS_HOST || 'localhost',
  port: process.env.REDIS_PORT || 6379,
  password: process.env.REDIS_PASSWORD || undefined,
  db: process.env.REDIS_DB || 0,
  retryDelayOnFailover: 100,
  enableReadyCheck: true,
  maxRetriesPerRequest: 3,
  lazyConnect: true,
  keepAlive: 30000,
  connectTimeout: 10000,
  commandTimeout: 5000,
  retryDelayOnClusterDown: 300,
  retryDelayOnFailover: 100,
  maxRetriesPerRequest: 3
};

// Create Redis client
const client = redis.createClient(redisConfig);

// Redis event handlers
client.on('connect', () => {
  console.log('Redis client connected');
});
client.on('ready', () => {
  console.log('Redis client ready');
});
client.on('error', err => {
  console.error('Redis client error:', err);
});
client.on('end', () => {
  console.log('Redis client disconnected');
});
client.on('reconnecting', () => {
  console.log('Redis client reconnecting');
});

// Redis v4+ already uses promises natively
const getAsync = client.get.bind(client);
const setAsync = client.set.bind(client);
const delAsync = client.del.bind(client);
const existsAsync = client.exists.bind(client);
const expireAsync = client.expire.bind(client);
const ttlAsync = client.ttl.bind(client);
const hgetAsync = client.hGet.bind(client);
const hsetAsync = client.hSet.bind(client);
const hdelAsync = client.hDel.bind(client);
const hgetallAsync = client.hGetAll.bind(client);
const saddAsync = client.sAdd.bind(client);
const sremAsync = client.sRem.bind(client);
const smembersAsync = client.sMembers.bind(client);
const sismemberAsync = client.sIsMember.bind(client);
const zaddAsync = client.zAdd.bind(client);
const zrangeAsync = client.zRange.bind(client);
const zremAsync = client.zRem.bind(client);
const incrAsync = client.incr.bind(client);
const decrAsync = client.decr.bind(client);
const incrbyAsync = client.incrBy.bind(client);
const decrbyAsync = client.decrBy.bind(client);

// Cache helper functions
const cache = {
  // Basic cache operations
  async get(key) {
    try {
      const value = await getAsync(key);
      return value ? JSON.parse(value) : null;
    } catch (error) {
      console.error('Cache get error:', error);
      return null;
    }
  },
  async set(key, value, ttl = 3600) {
    try {
      const serialized = JSON.stringify(value);
      if (ttl) {
        await setAsync(key, serialized, 'EX', ttl);
      } else {
        await setAsync(key, serialized);
      }
      return true;
    } catch (error) {
      console.error('Cache set error:', error);
      return false;
    }
  },
  async del(key) {
    try {
      return await delAsync(key);
    } catch (error) {
      console.error('Cache delete error:', error);
      return false;
    }
  },
  async exists(key) {
    try {
      return await existsAsync(key);
    } catch (error) {
      console.error('Cache exists error:', error);
      return false;
    }
  },
  async expire(key, ttl) {
    try {
      return await expireAsync(key, ttl);
    } catch (error) {
      console.error('Cache expire error:', error);
      return false;
    }
  },
  async ttl(key) {
    try {
      return await ttlAsync(key);
    } catch (error) {
      console.error('Cache TTL error:', error);
      return -1;
    }
  },
  async setex(key, ttl, value) {
    try {
      await setAsync(key, value, {
        EX: ttl
      });
      return true;
    } catch (error) {
      console.error('Cache setex error:', error);
      return false;
    }
  },
  // Hash operations
  async hget(key, field) {
    try {
      const value = await hgetAsync(key, field);
      return value ? JSON.parse(value) : null;
    } catch (error) {
      console.error('Cache hget error:', error);
      return null;
    }
  },
  async hset(key, field, value) {
    try {
      const serialized = JSON.stringify(value);
      return await hsetAsync(key, field, serialized);
    } catch (error) {
      console.error('Cache hset error:', error);
      return false;
    }
  },
  async hgetall(key) {
    try {
      const hash = await hgetallAsync(key);
      const result = {};
      for (const [field, value] of Object.entries(hash)) {
        result[field] = JSON.parse(value);
      }
      return result;
    } catch (error) {
      console.error('Cache hgetall error:', error);
      return {};
    }
  },
  // Set operations
  async sadd(key, ...members) {
    try {
      return await saddAsync(key, ...members);
    } catch (error) {
      console.error('Cache sadd error:', error);
      return false;
    }
  },
  async srem(key, ...members) {
    try {
      return await sremAsync(key, ...members);
    } catch (error) {
      console.error('Cache srem error:', error);
      return false;
    }
  },
  async smembers(key) {
    try {
      return await smembersAsync(key);
    } catch (error) {
      console.error('Cache smembers error:', error);
      return [];
    }
  },
  async sismember(key, member) {
    try {
      return await sismemberAsync(key, member);
    } catch (error) {
      console.error('Cache sismember error:', error);
      return false;
    }
  },
  // Counter operations
  async incr(key) {
    try {
      return await incrAsync(key);
    } catch (error) {
      console.error('Cache incr error:', error);
      return null;
    }
  },
  async decr(key) {
    try {
      return await decrAsync(key);
    } catch (error) {
      console.error('Cache decr error:', error);
      return null;
    }
  },
  async incrby(key, increment) {
    try {
      return await incrbyAsync(key, increment);
    } catch (error) {
      console.error('Cache incrby error:', error);
      return null;
    }
  }
};

// Session management helpers
const session = {
  async create(sessionId, userId, data = {}) {
    const sessionData = {
      userId,
      createdAt: new Date().toISOString(),
      lastActivity: new Date().toISOString(),
      ...data
    };
    const ttl = 24 * 60 * 60; // 24 hours
    return await cache.set(`session:${sessionId}`, sessionData, ttl);
  },
  async get(sessionId) {
    return await cache.get(`session:${sessionId}`);
  },
  async update(sessionId, data) {
    const existing = await this.get(sessionId);
    if (!existing) return false;
    const updated = {
      ...existing,
      ...data,
      lastActivity: new Date().toISOString()
    };
    return await cache.set(`session:${sessionId}`, updated, await cache.ttl(`session:${sessionId}`));
  },
  async destroy(sessionId) {
    return await cache.del(`session:${sessionId}`);
  },
  async destroyAllUserSessions(userId) {
    // This would require scanning all session keys, which is expensive
    // Better to maintain a user->sessions mapping
    const userSessions = await cache.smembers(`user_sessions:${userId}`);
    const promises = userSessions.map(sessionId => this.destroy(sessionId));
    await Promise.all(promises);
    return await cache.del(`user_sessions:${userId}`);
  }
};

// Rate limiting helpers
const rateLimit = {
  async check(key, limit, window) {
    const current = await cache.incr(key);
    if (current === 1) {
      await cache.expire(key, window);
    }
    return current <= limit;
  },
  async reset(key) {
    return await cache.del(key);
  }
};

// Health check
const healthCheck = async () => {
  try {
    await setAsync('health_check', 'ok', 'EX', 10);
    const result = await getAsync('health_check');
    return result === 'ok';
  } catch (error) {
    console.error('Redis health check failed:', error);
    return false;
  }
};

// Graceful shutdown
const close = () => {
  return new Promise(resolve => {
    client.quit(() => {
      console.log('Redis client closed');
      resolve();
    });
  });
};
module.exports = {
  client,
  cache,
  session,
  rateLimit,
  healthCheck,
  close
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZWRpcyIsInJlcXVpcmUiLCJyZWRpc0NvbmZpZyIsImhvc3QiLCJwcm9jZXNzIiwiZW52IiwiUkVESVNfSE9TVCIsInBvcnQiLCJSRURJU19QT1JUIiwicGFzc3dvcmQiLCJSRURJU19QQVNTV09SRCIsInVuZGVmaW5lZCIsImRiIiwiUkVESVNfREIiLCJyZXRyeURlbGF5T25GYWlsb3ZlciIsImVuYWJsZVJlYWR5Q2hlY2siLCJtYXhSZXRyaWVzUGVyUmVxdWVzdCIsImxhenlDb25uZWN0Iiwia2VlcEFsaXZlIiwiY29ubmVjdFRpbWVvdXQiLCJjb21tYW5kVGltZW91dCIsInJldHJ5RGVsYXlPbkNsdXN0ZXJEb3duIiwiY2xpZW50IiwiY3JlYXRlQ2xpZW50Iiwib24iLCJjb25zb2xlIiwibG9nIiwiZXJyIiwiZXJyb3IiLCJnZXRBc3luYyIsImdldCIsImJpbmQiLCJzZXRBc3luYyIsInNldCIsImRlbEFzeW5jIiwiZGVsIiwiZXhpc3RzQXN5bmMiLCJleGlzdHMiLCJleHBpcmVBc3luYyIsImV4cGlyZSIsInR0bEFzeW5jIiwidHRsIiwiaGdldEFzeW5jIiwiaEdldCIsImhzZXRBc3luYyIsImhTZXQiLCJoZGVsQXN5bmMiLCJoRGVsIiwiaGdldGFsbEFzeW5jIiwiaEdldEFsbCIsInNhZGRBc3luYyIsInNBZGQiLCJzcmVtQXN5bmMiLCJzUmVtIiwic21lbWJlcnNBc3luYyIsInNNZW1iZXJzIiwic2lzbWVtYmVyQXN5bmMiLCJzSXNNZW1iZXIiLCJ6YWRkQXN5bmMiLCJ6QWRkIiwienJhbmdlQXN5bmMiLCJ6UmFuZ2UiLCJ6cmVtQXN5bmMiLCJ6UmVtIiwiaW5jckFzeW5jIiwiaW5jciIsImRlY3JBc3luYyIsImRlY3IiLCJpbmNyYnlBc3luYyIsImluY3JCeSIsImRlY3JieUFzeW5jIiwiZGVjckJ5IiwiY2FjaGUiLCJrZXkiLCJ2YWx1ZSIsIkpTT04iLCJwYXJzZSIsInNlcmlhbGl6ZWQiLCJzdHJpbmdpZnkiLCJzZXRleCIsIkVYIiwiaGdldCIsImZpZWxkIiwiaHNldCIsImhnZXRhbGwiLCJoYXNoIiwicmVzdWx0IiwiT2JqZWN0IiwiZW50cmllcyIsInNhZGQiLCJtZW1iZXJzIiwic3JlbSIsInNtZW1iZXJzIiwic2lzbWVtYmVyIiwibWVtYmVyIiwiaW5jcmJ5IiwiaW5jcmVtZW50Iiwic2Vzc2lvbiIsImNyZWF0ZSIsInNlc3Npb25JZCIsInVzZXJJZCIsImRhdGEiLCJzZXNzaW9uRGF0YSIsImNyZWF0ZWRBdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImxhc3RBY3Rpdml0eSIsInVwZGF0ZSIsImV4aXN0aW5nIiwidXBkYXRlZCIsImRlc3Ryb3kiLCJkZXN0cm95QWxsVXNlclNlc3Npb25zIiwidXNlclNlc3Npb25zIiwicHJvbWlzZXMiLCJtYXAiLCJQcm9taXNlIiwiYWxsIiwicmF0ZUxpbWl0IiwiY2hlY2siLCJsaW1pdCIsIndpbmRvdyIsImN1cnJlbnQiLCJyZXNldCIsImhlYWx0aENoZWNrIiwiY2xvc2UiLCJyZXNvbHZlIiwicXVpdCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJyZWRpcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCByZWRpcyA9IHJlcXVpcmUoJ3JlZGlzJyk7XG5cbi8vIFJlZGlzIGNvbmZpZ3VyYXRpb25cbmNvbnN0IHJlZGlzQ29uZmlnID0ge1xuICBob3N0OiBwcm9jZXNzLmVudi5SRURJU19IT1NUIHx8ICdsb2NhbGhvc3QnLFxuICBwb3J0OiBwcm9jZXNzLmVudi5SRURJU19QT1JUIHx8IDYzNzksXG4gIHBhc3N3b3JkOiBwcm9jZXNzLmVudi5SRURJU19QQVNTV09SRCB8fCB1bmRlZmluZWQsXG4gIGRiOiBwcm9jZXNzLmVudi5SRURJU19EQiB8fCAwLFxuICByZXRyeURlbGF5T25GYWlsb3ZlcjogMTAwLFxuICBlbmFibGVSZWFkeUNoZWNrOiB0cnVlLFxuICBtYXhSZXRyaWVzUGVyUmVxdWVzdDogMyxcbiAgbGF6eUNvbm5lY3Q6IHRydWUsXG4gIGtlZXBBbGl2ZTogMzAwMDAsXG4gIGNvbm5lY3RUaW1lb3V0OiAxMDAwMCxcbiAgY29tbWFuZFRpbWVvdXQ6IDUwMDAsXG4gIHJldHJ5RGVsYXlPbkNsdXN0ZXJEb3duOiAzMDAsXG4gIHJldHJ5RGVsYXlPbkZhaWxvdmVyOiAxMDAsXG4gIG1heFJldHJpZXNQZXJSZXF1ZXN0OiAzXG59O1xuXG4vLyBDcmVhdGUgUmVkaXMgY2xpZW50XG5jb25zdCBjbGllbnQgPSByZWRpcy5jcmVhdGVDbGllbnQocmVkaXNDb25maWcpO1xuXG4vLyBSZWRpcyBldmVudCBoYW5kbGVyc1xuY2xpZW50Lm9uKCdjb25uZWN0JywgKCkgPT4ge1xuICBjb25zb2xlLmxvZygnUmVkaXMgY2xpZW50IGNvbm5lY3RlZCcpO1xufSk7XG5cbmNsaWVudC5vbigncmVhZHknLCAoKSA9PiB7XG4gIGNvbnNvbGUubG9nKCdSZWRpcyBjbGllbnQgcmVhZHknKTtcbn0pO1xuXG5jbGllbnQub24oJ2Vycm9yJywgKGVycikgPT4ge1xuICBjb25zb2xlLmVycm9yKCdSZWRpcyBjbGllbnQgZXJyb3I6JywgZXJyKTtcbn0pO1xuXG5jbGllbnQub24oJ2VuZCcsICgpID0+IHtcbiAgY29uc29sZS5sb2coJ1JlZGlzIGNsaWVudCBkaXNjb25uZWN0ZWQnKTtcbn0pO1xuXG5jbGllbnQub24oJ3JlY29ubmVjdGluZycsICgpID0+IHtcbiAgY29uc29sZS5sb2coJ1JlZGlzIGNsaWVudCByZWNvbm5lY3RpbmcnKTtcbn0pO1xuXG4vLyBSZWRpcyB2NCsgYWxyZWFkeSB1c2VzIHByb21pc2VzIG5hdGl2ZWx5XG5jb25zdCBnZXRBc3luYyA9IGNsaWVudC5nZXQuYmluZChjbGllbnQpO1xuY29uc3Qgc2V0QXN5bmMgPSBjbGllbnQuc2V0LmJpbmQoY2xpZW50KTtcbmNvbnN0IGRlbEFzeW5jID0gY2xpZW50LmRlbC5iaW5kKGNsaWVudCk7XG5jb25zdCBleGlzdHNBc3luYyA9IGNsaWVudC5leGlzdHMuYmluZChjbGllbnQpO1xuY29uc3QgZXhwaXJlQXN5bmMgPSBjbGllbnQuZXhwaXJlLmJpbmQoY2xpZW50KTtcbmNvbnN0IHR0bEFzeW5jID0gY2xpZW50LnR0bC5iaW5kKGNsaWVudCk7XG5jb25zdCBoZ2V0QXN5bmMgPSBjbGllbnQuaEdldC5iaW5kKGNsaWVudCk7XG5jb25zdCBoc2V0QXN5bmMgPSBjbGllbnQuaFNldC5iaW5kKGNsaWVudCk7XG5jb25zdCBoZGVsQXN5bmMgPSBjbGllbnQuaERlbC5iaW5kKGNsaWVudCk7XG5jb25zdCBoZ2V0YWxsQXN5bmMgPSBjbGllbnQuaEdldEFsbC5iaW5kKGNsaWVudCk7XG5jb25zdCBzYWRkQXN5bmMgPSBjbGllbnQuc0FkZC5iaW5kKGNsaWVudCk7XG5jb25zdCBzcmVtQXN5bmMgPSBjbGllbnQuc1JlbS5iaW5kKGNsaWVudCk7XG5jb25zdCBzbWVtYmVyc0FzeW5jID0gY2xpZW50LnNNZW1iZXJzLmJpbmQoY2xpZW50KTtcbmNvbnN0IHNpc21lbWJlckFzeW5jID0gY2xpZW50LnNJc01lbWJlci5iaW5kKGNsaWVudCk7XG5jb25zdCB6YWRkQXN5bmMgPSBjbGllbnQuekFkZC5iaW5kKGNsaWVudCk7XG5jb25zdCB6cmFuZ2VBc3luYyA9IGNsaWVudC56UmFuZ2UuYmluZChjbGllbnQpO1xuY29uc3QgenJlbUFzeW5jID0gY2xpZW50LnpSZW0uYmluZChjbGllbnQpO1xuY29uc3QgaW5jckFzeW5jID0gY2xpZW50LmluY3IuYmluZChjbGllbnQpO1xuY29uc3QgZGVjckFzeW5jID0gY2xpZW50LmRlY3IuYmluZChjbGllbnQpO1xuY29uc3QgaW5jcmJ5QXN5bmMgPSBjbGllbnQuaW5jckJ5LmJpbmQoY2xpZW50KTtcbmNvbnN0IGRlY3JieUFzeW5jID0gY2xpZW50LmRlY3JCeS5iaW5kKGNsaWVudCk7XG5cbi8vIENhY2hlIGhlbHBlciBmdW5jdGlvbnNcbmNvbnN0IGNhY2hlID0ge1xuICAvLyBCYXNpYyBjYWNoZSBvcGVyYXRpb25zXG4gIGFzeW5jIGdldChrZXkpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdmFsdWUgPSBhd2FpdCBnZXRBc3luYyhrZXkpO1xuICAgICAgcmV0dXJuIHZhbHVlID8gSlNPTi5wYXJzZSh2YWx1ZSkgOiBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdDYWNoZSBnZXQgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9LFxuXG4gIGFzeW5jIHNldChrZXksIHZhbHVlLCB0dGwgPSAzNjAwKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHNlcmlhbGl6ZWQgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gICAgICBpZiAodHRsKSB7XG4gICAgICAgIGF3YWl0IHNldEFzeW5jKGtleSwgc2VyaWFsaXplZCwgJ0VYJywgdHRsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGF3YWl0IHNldEFzeW5jKGtleSwgc2VyaWFsaXplZCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignQ2FjaGUgc2V0IGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0sXG5cbiAgYXN5bmMgZGVsKGtleSkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgZGVsQXN5bmMoa2V5KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignQ2FjaGUgZGVsZXRlIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0sXG5cbiAgYXN5bmMgZXhpc3RzKGtleSkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgZXhpc3RzQXN5bmMoa2V5KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignQ2FjaGUgZXhpc3RzIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0sXG5cbiAgYXN5bmMgZXhwaXJlKGtleSwgdHRsKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBleHBpcmVBc3luYyhrZXksIHR0bCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0NhY2hlIGV4cGlyZSBlcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9LFxuXG4gIGFzeW5jIHR0bChrZXkpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHR0bEFzeW5jKGtleSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0NhY2hlIFRUTCBlcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4gLTE7XG4gICAgfVxuICB9LFxuXG4gIGFzeW5jIHNldGV4KGtleSwgdHRsLCB2YWx1ZSkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBzZXRBc3luYyhrZXksIHZhbHVlLCB7IEVYOiB0dGwgfSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignQ2FjaGUgc2V0ZXggZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSxcblxuICAvLyBIYXNoIG9wZXJhdGlvbnNcbiAgYXN5bmMgaGdldChrZXksIGZpZWxkKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gYXdhaXQgaGdldEFzeW5jKGtleSwgZmllbGQpO1xuICAgICAgcmV0dXJuIHZhbHVlID8gSlNPTi5wYXJzZSh2YWx1ZSkgOiBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdDYWNoZSBoZ2V0IGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfSxcblxuICBhc3luYyBoc2V0KGtleSwgZmllbGQsIHZhbHVlKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHNlcmlhbGl6ZWQgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gICAgICByZXR1cm4gYXdhaXQgaHNldEFzeW5jKGtleSwgZmllbGQsIHNlcmlhbGl6ZWQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdDYWNoZSBoc2V0IGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0sXG5cbiAgYXN5bmMgaGdldGFsbChrZXkpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaGFzaCA9IGF3YWl0IGhnZXRhbGxBc3luYyhrZXkpO1xuICAgICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAgICBmb3IgKGNvbnN0IFtmaWVsZCwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGhhc2gpKSB7XG4gICAgICAgIHJlc3VsdFtmaWVsZF0gPSBKU09OLnBhcnNlKHZhbHVlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0NhY2hlIGhnZXRhbGwgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH1cbiAgfSxcblxuICAvLyBTZXQgb3BlcmF0aW9uc1xuICBhc3luYyBzYWRkKGtleSwgLi4ubWVtYmVycykge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgc2FkZEFzeW5jKGtleSwgLi4ubWVtYmVycyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0NhY2hlIHNhZGQgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSxcblxuICBhc3luYyBzcmVtKGtleSwgLi4ubWVtYmVycykge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgc3JlbUFzeW5jKGtleSwgLi4ubWVtYmVycyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0NhY2hlIHNyZW0gZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSxcblxuICBhc3luYyBzbWVtYmVycyhrZXkpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHNtZW1iZXJzQXN5bmMoa2V5KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignQ2FjaGUgc21lbWJlcnMgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfSxcblxuICBhc3luYyBzaXNtZW1iZXIoa2V5LCBtZW1iZXIpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHNpc21lbWJlckFzeW5jKGtleSwgbWVtYmVyKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignQ2FjaGUgc2lzbWVtYmVyIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0sXG5cbiAgLy8gQ291bnRlciBvcGVyYXRpb25zXG4gIGFzeW5jIGluY3Ioa2V5KSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBpbmNyQXN5bmMoa2V5KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignQ2FjaGUgaW5jciBlcnJvcjonLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH0sXG5cbiAgYXN5bmMgZGVjcihrZXkpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGRlY3JBc3luYyhrZXkpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdDYWNoZSBkZWNyIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfSxcblxuICBhc3luYyBpbmNyYnkoa2V5LCBpbmNyZW1lbnQpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGluY3JieUFzeW5jKGtleSwgaW5jcmVtZW50KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignQ2FjaGUgaW5jcmJ5IGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxufTtcblxuLy8gU2Vzc2lvbiBtYW5hZ2VtZW50IGhlbHBlcnNcbmNvbnN0IHNlc3Npb24gPSB7XG4gIGFzeW5jIGNyZWF0ZShzZXNzaW9uSWQsIHVzZXJJZCwgZGF0YSA9IHt9KSB7XG4gICAgY29uc3Qgc2Vzc2lvbkRhdGEgPSB7XG4gICAgICB1c2VySWQsXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIGxhc3RBY3Rpdml0eTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgLi4uZGF0YVxuICAgIH07XG4gICAgXG4gICAgY29uc3QgdHRsID0gMjQgKiA2MCAqIDYwOyAvLyAyNCBob3Vyc1xuICAgIHJldHVybiBhd2FpdCBjYWNoZS5zZXQoYHNlc3Npb246JHtzZXNzaW9uSWR9YCwgc2Vzc2lvbkRhdGEsIHR0bCk7XG4gIH0sXG5cbiAgYXN5bmMgZ2V0KHNlc3Npb25JZCkge1xuICAgIHJldHVybiBhd2FpdCBjYWNoZS5nZXQoYHNlc3Npb246JHtzZXNzaW9uSWR9YCk7XG4gIH0sXG5cbiAgYXN5bmMgdXBkYXRlKHNlc3Npb25JZCwgZGF0YSkge1xuICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgdGhpcy5nZXQoc2Vzc2lvbklkKTtcbiAgICBpZiAoIWV4aXN0aW5nKSByZXR1cm4gZmFsc2U7XG4gICAgXG4gICAgY29uc3QgdXBkYXRlZCA9IHtcbiAgICAgIC4uLmV4aXN0aW5nLFxuICAgICAgLi4uZGF0YSxcbiAgICAgIGxhc3RBY3Rpdml0eTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgfTtcbiAgICBcbiAgICByZXR1cm4gYXdhaXQgY2FjaGUuc2V0KGBzZXNzaW9uOiR7c2Vzc2lvbklkfWAsIHVwZGF0ZWQsIGF3YWl0IGNhY2hlLnR0bChgc2Vzc2lvbjoke3Nlc3Npb25JZH1gKSk7XG4gIH0sXG5cbiAgYXN5bmMgZGVzdHJveShzZXNzaW9uSWQpIHtcbiAgICByZXR1cm4gYXdhaXQgY2FjaGUuZGVsKGBzZXNzaW9uOiR7c2Vzc2lvbklkfWApO1xuICB9LFxuXG4gIGFzeW5jIGRlc3Ryb3lBbGxVc2VyU2Vzc2lvbnModXNlcklkKSB7XG4gICAgLy8gVGhpcyB3b3VsZCByZXF1aXJlIHNjYW5uaW5nIGFsbCBzZXNzaW9uIGtleXMsIHdoaWNoIGlzIGV4cGVuc2l2ZVxuICAgIC8vIEJldHRlciB0byBtYWludGFpbiBhIHVzZXItPnNlc3Npb25zIG1hcHBpbmdcbiAgICBjb25zdCB1c2VyU2Vzc2lvbnMgPSBhd2FpdCBjYWNoZS5zbWVtYmVycyhgdXNlcl9zZXNzaW9uczoke3VzZXJJZH1gKTtcbiAgICBjb25zdCBwcm9taXNlcyA9IHVzZXJTZXNzaW9ucy5tYXAoc2Vzc2lvbklkID0+IHRoaXMuZGVzdHJveShzZXNzaW9uSWQpKTtcbiAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgcmV0dXJuIGF3YWl0IGNhY2hlLmRlbChgdXNlcl9zZXNzaW9uczoke3VzZXJJZH1gKTtcbiAgfVxufTtcblxuLy8gUmF0ZSBsaW1pdGluZyBoZWxwZXJzXG5jb25zdCByYXRlTGltaXQgPSB7XG4gIGFzeW5jIGNoZWNrKGtleSwgbGltaXQsIHdpbmRvdykge1xuICAgIGNvbnN0IGN1cnJlbnQgPSBhd2FpdCBjYWNoZS5pbmNyKGtleSk7XG4gICAgaWYgKGN1cnJlbnQgPT09IDEpIHtcbiAgICAgIGF3YWl0IGNhY2hlLmV4cGlyZShrZXksIHdpbmRvdyk7XG4gICAgfVxuICAgIHJldHVybiBjdXJyZW50IDw9IGxpbWl0O1xuICB9LFxuXG4gIGFzeW5jIHJlc2V0KGtleSkge1xuICAgIHJldHVybiBhd2FpdCBjYWNoZS5kZWwoa2V5KTtcbiAgfVxufTtcblxuLy8gSGVhbHRoIGNoZWNrXG5jb25zdCBoZWFsdGhDaGVjayA9IGFzeW5jICgpID0+IHtcbiAgdHJ5IHtcbiAgICBhd2FpdCBzZXRBc3luYygnaGVhbHRoX2NoZWNrJywgJ29rJywgJ0VYJywgMTApO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldEFzeW5jKCdoZWFsdGhfY2hlY2snKTtcbiAgICByZXR1cm4gcmVzdWx0ID09PSAnb2snO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1JlZGlzIGhlYWx0aCBjaGVjayBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcblxuLy8gR3JhY2VmdWwgc2h1dGRvd25cbmNvbnN0IGNsb3NlID0gKCkgPT4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICBjbGllbnQucXVpdCgoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnUmVkaXMgY2xpZW50IGNsb3NlZCcpO1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH0pO1xuICB9KTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBjbGllbnQsXG4gIGNhY2hlLFxuICBzZXNzaW9uLFxuICByYXRlTGltaXQsXG4gIGhlYWx0aENoZWNrLFxuICBjbG9zZVxufTsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLEtBQUssR0FBR0MsT0FBTyxDQUFDLE9BQU8sQ0FBQzs7QUFFOUI7QUFDQSxNQUFNQyxXQUFXLEdBQUc7RUFDbEJDLElBQUksRUFBRUMsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFVBQVUsSUFBSSxXQUFXO0VBQzNDQyxJQUFJLEVBQUVILE9BQU8sQ0FBQ0MsR0FBRyxDQUFDRyxVQUFVLElBQUksSUFBSTtFQUNwQ0MsUUFBUSxFQUFFTCxPQUFPLENBQUNDLEdBQUcsQ0FBQ0ssY0FBYyxJQUFJQyxTQUFTO0VBQ2pEQyxFQUFFLEVBQUVSLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDUSxRQUFRLElBQUksQ0FB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